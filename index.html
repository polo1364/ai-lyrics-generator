<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ­Œè©ç”Ÿæˆå™¨ | Suno å°ˆç”¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .input-section {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 1.1em;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* å¤šé¸ä¸‹æ‹‰å¼ Checkbox æ¨£å¼ */
        .multi-select-container {
            position: relative;
        }

        .multi-select-display {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s;
        }

        .multi-select-display:hover {
            border-color: #667eea;
        }

        .multi-select-display.active {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .selected-items {
            flex: 1;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            min-height: 24px;
            align-items: center;
        }

        .selected-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            animation: tagSlideIn 0.2s ease-out;
            white-space: nowrap;
        }

        @keyframes tagSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .selected-tag .remove-tag {
            cursor: pointer;
            font-weight: bold;
            padding: 0 2px;
            border-radius: 50%;
            transition: all 0.2s;
            font-size: 1.1em;
            line-height: 1;
        }

        .selected-tag .remove-tag:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.2);
        }

        .multi-select-placeholder {
            color: #999;
            font-size: 1em;
        }

        .multi-select-arrow {
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 7px solid #666;
            transition: transform 0.3s;
            margin-left: 10px;
            flex-shrink: 0;
        }

        .multi-select-arrow.open {
            transform: rotate(180deg);
        }

        .multi-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            margin-top: 5px;
            max-height: 350px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .multi-select-dropdown.show {
            display: block;
            animation: dropdownSlide 0.3s ease-out;
        }

        @keyframes dropdownSlide {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dropdown-search {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            background: white;
            z-index: 2;
        }

        .dropdown-search input {
            padding: 8px 12px;
            font-size: 0.9em;
            border-radius: 8px;
        }

        .dropdown-group {
            border-bottom: 1px solid #f0f0f0;
        }

        .dropdown-group:last-child {
            border-bottom: none;
        }

        .dropdown-group-label {
            padding: 10px 15px;
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
            font-weight: 600;
            color: #667eea;
            font-size: 0.9em;
            position: sticky;
            top: 0;
            z-index: 1;
            border-bottom: 1px solid #e8e8e8;
        }

        .dropdown-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dropdown-option:hover {
            background: #f8f9ff;
        }

        .dropdown-option.selected {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .dropdown-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #667eea;
            flex-shrink: 0;
        }

        .dropdown-option label {
            flex: 1;
            cursor: pointer;
            margin: 0;
            font-size: 0.95em;
            font-weight: normal;
        }

        .dropdown-actions {
            padding: 10px 15px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            background: #fafafa;
            position: sticky;
            bottom: 0;
        }

        .dropdown-actions button {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-select-all {
            background: #667eea;
            color: white;
        }

        .btn-select-all:hover {
            background: #5a6fd6;
        }

        .btn-clear-all {
            background: #e0e0e0;
            color: #333;
        }

        .btn-clear-all:hover {
            background: #d0d0d0;
        }

        /* éš±è—åŸç”Ÿçš„å¤šé¸æ¡† */
        select[multiple] {
            display: none !important;
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 10px;
            margin-top: 10px;
        }

        .random-btn {
            background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
            padding: 15px;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .random-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }

        .random-btn:active {
            transform: translateY(0);
        }

        .button-group button {
            margin-top: 0;
        }

        .result-section {
            background: #fff;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #667eea;
            margin-top: 20px;
            display: none;
        }

        .result-section.show {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .lyrics-output {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            line-height: 1.8;
            color: #333;
            max-height: 500px;
            overflow-y: auto;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .copy-btn, .suno-btn {
            padding: 12px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .copy-btn {
            background: #4CAF50;
            color: white;
        }

        .copy-btn:hover {
            background: #45a049;
        }

        .suno-btn {
            background: #FF6B6B;
            color: white;
        }

        .suno-btn:hover {
            background: #ee5a5a;
        }

        .export-btn, .import-btn {
            padding: 12px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .export-btn {
            background: #9C27B0;
            color: white;
        }

        .export-btn:hover {
            background: #7B1FA2;
        }

        .import-btn {
            background: #00BCD4;
            color: white;
        }

        .import-btn:hover {
            background: #0097A7;
        }

        .style-output-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            color: white;
            position: relative;
        }

        .style-output-box h3 {
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .style-text {
            background: rgba(255, 255, 255, 0.15);
            padding: 12px;
            border-radius: 8px;
            word-break: break-word;
            line-height: 1.6;
            font-size: 0.95em;
            min-height: 60px;
            display: flex;
            align-items: center;
        }

        .copy-style-btn {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            padding: 8px 15px;
            border: 2px solid white;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            width: 100%;
        }

        .copy-style-btn:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-2px);
        }

        .copy-style-btn:active {
            transform: translateY(0);
        }

        .style-prompt-section {
            background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: white;
        }

        .style-prompt-section h3 {
            margin-bottom: 12px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .style-prompt-output {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 8px;
            word-break: break-word;
            line-height: 1.6;
            font-size: 0.95em;
            min-height: 60px;
            margin-bottom: 10px;
        }

        .copy-style-prompt-btn {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            padding: 10px 15px;
            border: 2px solid white;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .copy-style-prompt-btn:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-2px);
        }

        .copy-style-prompt-btn:active {
            transform: translateY(0);
        }


        .style-feedback {
            font-size: 0.85em;
            margin-top: 8px;
            opacity: 0.9;
        }


        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tips {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #ffc107;
        }

        .tips h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .tips ul {
            margin-left: 20px;
            color: #856404;
        }

        .tips li {
            margin-bottom: 5px;
        }

        /* æ¨¡æ…‹è¦–çª—æ¨£å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlide 0.3s ease-out;
        }

        @keyframes modalSlide {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .modal-header p {
            color: #666;
            font-size: 0.95em;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .modal-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .modal-footer {
            display: flex;
            gap: 10px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .modal-btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .modal-btn-secondary:hover {
            background: #d0d0d0;
        }

        .settings-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            z-index: 999;
        }

        .settings-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }

        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }

        .info-box p {
            color: #1565c0;
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .info-box a {
            color: #1976d2;
            text-decoration: none;
            font-weight: 600;
        }

        .info-box a:hover {
            text-decoration: underline;
        }

        /* é¸æ“‡æ•¸é‡æç¤º */
        .selection-count {
            font-size: 0.8em;
            color: #888;
            margin-left: 8px;
            font-weight: normal;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .row {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }

            .button-group {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 25px;
            }

            .settings-btn {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 1.2em;
            }

            .selected-tag {
                font-size: 0.8em;
                padding: 3px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ AI æ­Œè©ç”Ÿæˆå™¨</h1>
        <p class="subtitle">ç‚º Suno AI é‡èº«æ‰“é€ ï¼Œä¸€éµç”Ÿæˆå°ˆæ¥­æ­Œè©æ ¼å¼</p>

        <div class="input-section">
            <div class="form-group">
                <label>ğŸ¯ æ­Œæ›²ä¸»é¡Œ *</label>
                <input type="text" id="theme" placeholder="ä¾‹å¦‚ï¼šå¤±æˆ€ã€è¿½å¤¢ã€å‹æƒ…ã€æ„›æƒ…ã€é’æ˜¥å›æ†¶..." required>
            </div>

            <div class="row">
                <!-- éŸ³æ¨‚é¢¨æ ¼ -->
                <div class="form-group">
                    <label>ğŸ¼ éŸ³æ¨‚é¢¨æ ¼ <span class="selection-count" id="genreCount"></span></label>
                    <div class="multi-select-container" id="genreContainer">
                        <div class="multi-select-display" onclick="toggleDropdown('genre')">
                            <div class="selected-items" id="genreSelected">
                                <span class="multi-select-placeholder">é»æ“Šé¸æ“‡é¢¨æ ¼...</span>
                            </div>
                            <div class="multi-select-arrow" id="genreArrow"></div>
                        </div>
                        <div class="multi-select-dropdown" id="genreDropdown">
                            <div class="dropdown-group">
                                <div class="dropdown-group-label">ğŸ¤ æµè¡Œç³»</div>
                                <div class="dropdown-option"><input type="checkbox" id="g_æµè¡Œæ–æ»¾" value="æµè¡Œæ–æ»¾" onchange="updateMultiSelect('genre')"><label for="g_æµè¡Œæ–æ»¾">æµè¡Œæ–æ»¾ (Pop Rock)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_é›»å­æµè¡Œ" value="é›»å­æµè¡Œ" onchange="updateMultiSelect('genre')"><label for="g_é›»å­æµè¡Œ">é›»å­æµè¡Œ (Synth Pop)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_K-Pop" value="K-Pop" onchange="updateMultiSelect('genre')"><label for="g_K-Pop">K-Pop</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_J-Pop" value="J-Pop" onchange="updateMultiSelect('genre')"><label for="g_J-Pop">J-Pop</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_æŠ’æƒ…æµè¡Œ" value="æŠ’æƒ…æµè¡Œ" onchange="updateMultiSelect('genre')"><label for="g_æŠ’æƒ…æµè¡Œ">æŠ’æƒ…æµè¡Œ (Pop Ballad)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_èˆæ›²æµè¡Œ" value="èˆæ›²æµè¡Œ" onchange="updateMultiSelect('genre')"><label for="g_èˆæ›²æµè¡Œ">èˆæ›²æµè¡Œ (Dance Pop)</label></div>
                            </div>
                            <div class="dropdown-group">
                                <div class="dropdown-group-label">ğŸ¸ æ–æ»¾ç³»</div>
                                <div class="dropdown-option"><input type="checkbox" id="g_æ–æ»¾" value="æ–æ»¾" onchange="updateMultiSelect('genre')"><label for="g_æ–æ»¾">æ–æ»¾ (Rock)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_å¦é¡æ–æ»¾" value="å¦é¡æ–æ»¾" onchange="updateMultiSelect('genre')"><label for="g_å¦é¡æ–æ»¾">å¦é¡æ–æ»¾ (Alternative)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_é¾å…‹" value="é¾å…‹" onchange="updateMultiSelect('genre')"><label for="g_é¾å…‹">é¾å…‹ (Punk)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_é‡‘å±¬" value="é‡‘å±¬" onchange="updateMultiSelect('genre')"><label for="g_é‡‘å±¬">é‡‘å±¬ (Metal)</label></div>
                            </div>
                            <div class="dropdown-group">
                                <div class="dropdown-group-label">ğŸ¤ å˜»å“ˆ/R&B</div>
                                <div class="dropdown-option"><input type="checkbox" id="g_å˜»å“ˆé¥’èˆŒ" value="å˜»å“ˆé¥’èˆŒ" onchange="updateMultiSelect('genre')"><label for="g_å˜»å“ˆé¥’èˆŒ">å˜»å“ˆé¥’èˆŒ (Hip Hop)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_é™·é˜±éŸ³æ¨‚" value="é™·é˜±éŸ³æ¨‚" onchange="updateMultiSelect('genre')"><label for="g_é™·é˜±éŸ³æ¨‚">é™·é˜±éŸ³æ¨‚ (Trap)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_R&B" value="R&B" onchange="updateMultiSelect('genre')"><label for="g_R&B">R&B</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_éˆé­‚æ¨‚" value="éˆé­‚æ¨‚" onchange="updateMultiSelect('genre')"><label for="g_éˆé­‚æ¨‚">éˆé­‚æ¨‚ (Soul)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_æ”¾å…‹" value="æ”¾å…‹" onchange="updateMultiSelect('genre')"><label for="g_æ”¾å…‹">æ”¾å…‹ (Funk)</label></div>
                            </div>
                            <div class="dropdown-group">
                                <div class="dropdown-group-label">ğŸ›ï¸ é›»å­éŸ³æ¨‚</div>
                                <div class="dropdown-option"><input type="checkbox" id="g_EDM" value="EDM" onchange="updateMultiSelect('genre')"><label for="g_EDM">EDM</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_æµ©å®¤" value="æµ©å®¤" onchange="updateMultiSelect('genre')"><label for="g_æµ©å®¤">æµ©å®¤ (House)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_éµå…‹è«¾" value="éµå…‹è«¾" onchange="updateMultiSelect('genre')"><label for="g_éµå…‹è«¾">éµå…‹è«¾ (Techno)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_è¿´éŸ¿è²æ–¯" value="è¿´éŸ¿è²æ–¯" onchange="updateMultiSelect('genre')"><label for="g_è¿´éŸ¿è²æ–¯">è¿´éŸ¿è²æ–¯ (Dubstep)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_æ°›åœé›»å­" value="æ°›åœé›»å­" onchange="updateMultiSelect('genre')"><label for="g_æ°›åœé›»å­">æ°›åœé›»å­ (Ambient)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_åˆæˆå™¨æµè¡Œ" value="åˆæˆå™¨æµè¡Œ" onchange="updateMultiSelect('genre')"><label for="g_åˆæˆå™¨æµè¡Œ">åˆæˆå™¨æµè¡Œ (Synthwave)</label></div>
                            </div>
                            <div class="dropdown-group">
                                <div class="dropdown-group-label">ğŸ» æ°‘è¬ /å¤å…¸</div>
                                <div class="dropdown-option"><input type="checkbox" id="g_æŠ’æƒ…æ°‘è¬ " value="æŠ’æƒ…æ°‘è¬ " onchange="updateMultiSelect('genre')"><label for="g_æŠ’æƒ…æ°‘è¬ ">æŠ’æƒ…æ°‘è¬  (Folk Ballad)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_é„‰æ‘" value="é„‰æ‘" onchange="updateMultiSelect('genre')"><label for="g_é„‰æ‘">é„‰æ‘ (Country)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_è—è‰" value="è—è‰" onchange="updateMultiSelect('genre')"><label for="g_è—è‰">è—è‰ (Bluegrass)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_å¤å…¸" value="å¤å…¸" onchange="updateMultiSelect('genre')"><label for="g_å¤å…¸">å¤å…¸ (Classical)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_æ–°ä¸–ç´€" value="æ–°ä¸–ç´€" onchange="updateMultiSelect('genre')"><label for="g_æ–°ä¸–ç´€">æ–°ä¸–ç´€ (New Age)</label></div>
                            </div>
                            <div class="dropdown-group">
                                <div class="dropdown-group-label">ğŸ· çˆµå£«/è—èª¿</div>
                                <div class="dropdown-option"><input type="checkbox" id="g_çˆµå£«" value="çˆµå£«" onchange="updateMultiSelect('genre')"><label for="g_çˆµå£«">çˆµå£« (Jazz)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_è—èª¿" value="è—èª¿" onchange="updateMultiSelect('genre')"><label for="g_è—èª¿">è—èª¿ (Blues)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_æ³¢è–©è«¾ç“¦" value="æ³¢è–©è«¾ç“¦" onchange="updateMultiSelect('genre')"><label for="g_æ³¢è–©è«¾ç“¦">æ³¢è–©è«¾ç“¦ (Bossa Nova)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_æ–æ“ºæ¨‚" value="æ–æ“ºæ¨‚" onchange="updateMultiSelect('genre')"><label for="g_æ–æ“ºæ¨‚">æ–æ“ºæ¨‚ (Swing)</label></div>
                            </div>
                            <div class="dropdown-group">
                                <div class="dropdown-group-label">ğŸŒ å…¶ä»–</div>
                                <div class="dropdown-option"><input type="checkbox" id="g_ç¨ç«‹éŸ³æ¨‚" value="ç¨ç«‹éŸ³æ¨‚" onchange="updateMultiSelect('genre')"><label for="g_ç¨ç«‹éŸ³æ¨‚">ç¨ç«‹éŸ³æ¨‚ (Indie)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_é›·é¬¼" value="é›·é¬¼" onchange="updateMultiSelect('genre')"><label for="g_é›·é¬¼">é›·é¬¼ (Reggae)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_æ‹‰ä¸" value="æ‹‰ä¸" onchange="updateMultiSelect('genre')"><label for="g_æ‹‰ä¸">æ‹‰ä¸ (Latin)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_ç¦éŸ³" value="ç¦éŸ³" onchange="updateMultiSelect('genre')"><label for="g_ç¦éŸ³">ç¦éŸ³ (Gospel)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_è¿·å¹»æ–æ»¾" value="è¿·å¹»æ–æ»¾" onchange="updateMultiSelect('genre')"><label for="g_è¿·å¹»æ–æ»¾">è¿·å¹»æ–æ»¾ (Psychedelic)</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="g_å¯¦é©—éŸ³æ¨‚" value="å¯¦é©—éŸ³æ¨‚" onchange="updateMultiSelect('genre')"><label for="g_å¯¦é©—éŸ³æ¨‚">å¯¦é©—éŸ³æ¨‚ (Experimental)</label></div>
                            </div>
                            <div class="dropdown-actions">
                                <button type="button" class="btn-clear-all" onclick="clearAll('genre')">æ¸…é™¤å…¨éƒ¨</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æƒ…æ„ŸåŸºèª¿ -->
                <div class="form-group">
                    <label>ğŸ˜Š æƒ…æ„ŸåŸºèª¿ <span class="selection-count" id="moodCount"></span></label>
                    <div class="multi-select-container" id="moodContainer">
                        <div class="multi-select-display" onclick="toggleDropdown('mood')">
                            <div class="selected-items" id="moodSelected">
                                <span class="multi-select-placeholder">é»æ“Šé¸æ“‡æƒ…æ„Ÿ...</span>
                            </div>
                            <div class="multi-select-arrow" id="moodArrow"></div>
                        </div>
                        <div class="multi-select-dropdown" id="moodDropdown">
                            <div class="dropdown-group">
                                <div class="dropdown-group-label">ğŸ˜„ æ­£é¢æƒ…ç·’</div>
                                <div class="dropdown-option"><input type="checkbox" id="m_è¼•é¬†æ„‰å¿«" value="è¼•é¬†æ„‰å¿«" onchange="updateMultiSelect('mood')"><label for="m_è¼•é¬†æ„‰å¿«">è¼•é¬†æ„‰å¿« ğŸ˜„</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_ç†±è¡€æ¿€æ˜‚" value="ç†±è¡€æ¿€æ˜‚" onchange="updateMultiSelect('mood')"><label for="m_ç†±è¡€æ¿€æ˜‚">ç†±è¡€æ¿€æ˜‚ ğŸ”¥</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_æµªæ¼«ç”œèœœ" value="æµªæ¼«ç”œèœœ" onchange="updateMultiSelect('mood')"><label for="m_æµªæ¼«ç”œèœœ">æµªæ¼«ç”œèœœ ğŸ’•</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_æº«æš–æ²»ç™’" value="æº«æš–æ²»ç™’" onchange="updateMultiSelect('mood')"><label for="m_æº«æš–æ²»ç™’">æº«æš–æ²»ç™’ ğŸŒŸ</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_å‹µå¿—å‘ä¸Š" value="å‹µå¿—å‘ä¸Š" onchange="updateMultiSelect('mood')"><label for="m_å‹µå¿—å‘ä¸Š">å‹µå¿—å‘ä¸Š ğŸ’ª</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_æ­¡æ¨‚æ…¶ç¥" value="æ­¡æ¨‚æ…¶ç¥" onchange="updateMultiSelect('mood')"><label for="m_æ­¡æ¨‚æ…¶ç¥">æ­¡æ¨‚æ…¶ç¥ ğŸ‰</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_å……æ»¿å¸Œæœ›" value="å……æ»¿å¸Œæœ›" onchange="updateMultiSelect('mood')"><label for="m_å……æ»¿å¸Œæœ›">å……æ»¿å¸Œæœ› âœ¨</label></div>
                            </div>
                            <div class="dropdown-group">
                                <div class="dropdown-group-label">â¤ï¸ æ·±æƒ…ç³»</div>
                                <div class="dropdown-option"><input type="checkbox" id="m_æ·±æƒ…æ¬¾æ¬¾" value="æ·±æƒ…æ¬¾æ¬¾" onchange="updateMultiSelect('mood')"><label for="m_æ·±æƒ…æ¬¾æ¬¾">æ·±æƒ…æ¬¾æ¬¾ â¤ï¸</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_æ€å¿µæƒ³å¿µ" value="æ€å¿µæƒ³å¿µ" onchange="updateMultiSelect('mood')"><label for="m_æ€å¿µæƒ³å¿µ">æ€å¿µæƒ³å¿µ ğŸ’­</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_æ„Ÿæ©æ„Ÿè¬" value="æ„Ÿæ©æ„Ÿè¬" onchange="updateMultiSelect('mood')"><label for="m_æ„Ÿæ©æ„Ÿè¬">æ„Ÿæ©æ„Ÿè¬ ğŸ™</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_æº«æŸ”ç´°è†©" value="æº«æŸ”ç´°è†©" onchange="updateMultiSelect('mood')"><label for="m_æº«æŸ”ç´°è†©">æº«æŸ”ç´°è†© ğŸŒ¸</label></div>
                            </div>
                            <div class="dropdown-group">
                                <div class="dropdown-group-label">ğŸ˜¢ è² é¢æƒ…ç·’</div>
                                <div class="dropdown-option"><input type="checkbox" id="m_å‚·æ„Ÿæ†‚é¬±" value="å‚·æ„Ÿæ†‚é¬±" onchange="updateMultiSelect('mood')"><label for="m_å‚·æ„Ÿæ†‚é¬±">å‚·æ„Ÿæ†‚é¬± ğŸ˜¢</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_å¤±è½è¿·æƒ˜" value="å¤±è½è¿·æƒ˜" onchange="updateMultiSelect('mood')"><label for="m_å¤±è½è¿·æƒ˜">å¤±è½è¿·æƒ˜ ğŸŒ§ï¸</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_å¿ƒç¢ç—›è‹¦" value="å¿ƒç¢ç—›è‹¦" onchange="updateMultiSelect('mood')"><label for="m_å¿ƒç¢ç—›è‹¦">å¿ƒç¢ç—›è‹¦ ğŸ’”</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_æ†¤æ€’ä¸æ»¿" value="æ†¤æ€’ä¸æ»¿" onchange="updateMultiSelect('mood')"><label for="m_æ†¤æ€’ä¸æ»¿">æ†¤æ€’ä¸æ»¿ ğŸ˜ </label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_å­¤ç¨å¯‚å¯" value="å­¤ç¨å¯‚å¯" onchange="updateMultiSelect('mood')"><label for="m_å­¤ç¨å¯‚å¯">å­¤ç¨å¯‚å¯ ğŸŒ™</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_ç„¦æ…®ä¸å®‰" value="ç„¦æ…®ä¸å®‰" onchange="updateMultiSelect('mood')"><label for="m_ç„¦æ…®ä¸å®‰">ç„¦æ…®ä¸å®‰ ğŸ˜°</label></div>
                            </div>
                            <div class="dropdown-group">
                                <div class="dropdown-group-label">ğŸ“¼ æ‡·èˆŠ/å›æ†¶</div>
                                <div class="dropdown-option"><input type="checkbox" id="m_æ‡·èˆŠæ„Ÿå‚·" value="æ‡·èˆŠæ„Ÿå‚·" onchange="updateMultiSelect('mood')"><label for="m_æ‡·èˆŠæ„Ÿå‚·">æ‡·èˆŠæ„Ÿå‚· ğŸ“¼</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_é’æ˜¥å›æ†¶" value="é’æ˜¥å›æ†¶" onchange="updateMultiSelect('mood')"><label for="m_é’æ˜¥å›æ†¶">é’æ˜¥å›æ†¶ ğŸŒˆ</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_å¾€æ—¥æƒ…æ‡·" value="å¾€æ—¥æƒ…æ‡·" onchange="updateMultiSelect('mood')"><label for="m_å¾€æ—¥æƒ…æ‡·">å¾€æ—¥æƒ…æ‡· â°</label></div>
                            </div>
                            <div class="dropdown-group">
                                <div class="dropdown-group-label">ğŸŒ€ ç‰¹æ®Šæ°›åœ</div>
                                <div class="dropdown-option"><input type="checkbox" id="m_ç¥ç§˜è©­ç•°" value="ç¥ç§˜è©­ç•°" onchange="updateMultiSelect('mood')"><label for="m_ç¥ç§˜è©­ç•°">ç¥ç§˜è©­ç•° ğŸŒ‘</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_å›é€†åæŠ—" value="å›é€†åæŠ—" onchange="updateMultiSelect('mood')"><label for="m_å›é€†åæŠ—">å›é€†åæŠ— âš¡</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_å¤¢å¹»è¿·å¹»" value="å¤¢å¹»è¿·å¹»" onchange="updateMultiSelect('mood')"><label for="m_å¤¢å¹»è¿·å¹»">å¤¢å¹»è¿·å¹» ğŸŒ€</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_å²è©©å£¯é—Š" value="å²è©©å£¯é—˜" onchange="updateMultiSelect('mood')"><label for="m_å²è©©å£¯é—˜">å²è©©å£¯é—˜ âš”ï¸</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_æ…µæ‡¶æ”¾é¬†" value="æ…µæ‡¶æ”¾é¬†" onchange="updateMultiSelect('mood')"><label for="m_æ…µæ‡¶æ”¾é¬†">æ…µæ‡¶æ”¾é¬† â˜•</label></div>
                                <div class="dropdown-option"><input type="checkbox" id="m_æ€§æ„Ÿæ’©äºº" value="æ€§æ„Ÿæ’©äºº" onchange="updateMultiSelect('mood')"><label for="m_æ€§æ„Ÿæ’©äºº">æ€§æ„Ÿæ’©äºº ğŸ”¥</label></div>
                            </div>
                            <div class="dropdown-actions">
                                <button type="button" class="btn-clear-all" onclick="clearAll('mood')">æ¸…é™¤å…¨éƒ¨</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="form-group">
                    <label>ğŸ“ æ­Œè©èªè¨€</label>
                    <select id="language">
                        <option value="ä¸­æ–‡">ä¸­æ–‡ ğŸ‡¹ğŸ‡¼</option>
                        <option value="è‹±æ–‡">è‹±æ–‡ ğŸ‡ºğŸ‡¸</option>
                        <option value="æ—¥æ–‡">æ—¥æ–‡ ğŸ‡¯ğŸ‡µ</option>
                        <option value="ä¸­è‹±æ··åˆ">ä¸­è‹±æ··åˆ</option>
                        <option value="æ—¥è‹±æ··åˆ">æ—¥è‹±æ··åˆ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ğŸ¤ æ¼”å”±è²éŸ³</label>
                    <select id="voice">
                        <option value="ç”·è²">ç”·è² (Male)</option>
                        <option value="å¥³è²">å¥³è² (Female)</option>
                        <option value="ç”·å¥³å°å”±">ç”·å¥³å°å”± (Duet)</option>
                        <option value="ä¸æŒ‡å®š">ä¸æŒ‡å®š</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="form-group">
                    <label>â±ï¸ æ­Œæ›²é•·åº¦</label>
                    <select id="duration">
                        <option value="çŸ­ç‰ˆ (2-2.5åˆ†é˜)">çŸ­ç‰ˆ (2-2.5åˆ†é˜) âš¡</option>
                        <option value="æ¨™æº– (3-3.5åˆ†é˜)" selected>æ¨™æº– (3-3.5åˆ†é˜) ğŸµ</option>
                        <option value="å®Œæ•´ç‰ˆ (4-5åˆ†é˜)">å®Œæ•´ç‰ˆ (4-5åˆ†é˜) ğŸ“€</option>
                        <option value="åŠ é•·ç‰ˆ (5-6åˆ†é˜)">åŠ é•·ç‰ˆ (5-6åˆ†é˜) ğŸ¸</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ğŸ”¢ ç”Ÿæˆæ•¸é‡</label>
                    <select id="count">
                        <option value="1" selected>1 é¦–</option>
                        <option value="2">2 é¦–</option>
                        <option value="3">3 é¦–</option>
                        <option value="4">4 é¦–</option>
                        <option value="5">5 é¦–</option>
                    </select>
                </div>
            </div>

            <!-- ä¸»è¦æ¨‚å™¨ -->
            <div class="form-group">
                <label>ğŸ¹ ä¸»è¦æ¨‚å™¨ <span class="selection-count" id="instrumentsCount"></span></label>
                <div class="multi-select-container" id="instrumentsContainer">
                    <div class="multi-select-display" onclick="toggleDropdown('instruments')">
                        <div class="selected-items" id="instrumentsSelected">
                            <span class="multi-select-placeholder">é»æ“Šé¸æ“‡æ¨‚å™¨...</span>
                        </div>
                        <div class="multi-select-arrow" id="instrumentsArrow"></div>
                    </div>
                    <div class="multi-select-dropdown" id="instrumentsDropdown">
                        <div class="dropdown-group">
                            <div class="dropdown-group-label">ğŸ¸ å¼¦æ¨‚å™¨</div>
                            <div class="dropdown-option"><input type="checkbox" id="i_å‰ä»–" value="å‰ä»–" onchange="updateMultiSelect('instruments')"><label for="i_å‰ä»–">å‰ä»– (Guitar) ğŸ¸</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_é›»å‰ä»–" value="é›»å‰ä»–" onchange="updateMultiSelect('instruments')"><label for="i_é›»å‰ä»–">é›»å‰ä»– (Electric Guitar) âš¡</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_è²æ–¯" value="è²æ–¯" onchange="updateMultiSelect('instruments')"><label for="i_è²æ–¯">è²æ–¯ (Bass) ğŸ¸</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_å°æç´" value="å°æç´" onchange="updateMultiSelect('instruments')"><label for="i_å°æç´">å°æç´ (Violin) ğŸ»</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_å¤§æç´" value="å¤§æç´" onchange="updateMultiSelect('instruments')"><label for="i_å¤§æç´">å¤§æç´ (Cello) ğŸ»</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_çƒå…‹éº—éº—" value="çƒå…‹éº—éº—" onchange="updateMultiSelect('instruments')"><label for="i_çƒå…‹éº—éº—">çƒå…‹éº—éº— (Ukulele) ğŸ¸</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_è±ç´" value="è±ç´" onchange="updateMultiSelect('instruments')"><label for="i_è±ç´">è±ç´ (Harp) ğŸ¼</label></div>
                        </div>
                        <div class="dropdown-group">
                            <div class="dropdown-group-label">ğŸ¹ éµç›¤æ¨‚å™¨</div>
                            <div class="dropdown-option"><input type="checkbox" id="i_é‹¼ç´" value="é‹¼ç´" onchange="updateMultiSelect('instruments')"><label for="i_é‹¼ç´">é‹¼ç´ (Piano) ğŸ¹</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_é›»å­ç´" value="é›»å­ç´" onchange="updateMultiSelect('instruments')"><label for="i_é›»å­ç´">é›»å­ç´ (Keyboard) ğŸ¹</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_åˆæˆå™¨" value="åˆæˆå™¨" onchange="updateMultiSelect('instruments')"><label for="i_åˆæˆå™¨">åˆæˆå™¨ (Synthesizer) ğŸ›ï¸</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_ç®¡é¢¨ç´" value="ç®¡é¢¨ç´" onchange="updateMultiSelect('instruments')"><label for="i_ç®¡é¢¨ç´">ç®¡é¢¨ç´ (Organ) ğŸ¹</label></div>
                        </div>
                        <div class="dropdown-group">
                            <div class="dropdown-group-label">ğŸ· ç®¡æ¨‚å™¨</div>
                            <div class="dropdown-option"><input type="checkbox" id="i_è–©å…‹æ–¯é¢¨" value="è–©å…‹æ–¯é¢¨" onchange="updateMultiSelect('instruments')"><label for="i_è–©å…‹æ–¯é¢¨">è–©å…‹æ–¯é¢¨ (Saxophone) ğŸ·</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_å°è™Ÿ" value="å°è™Ÿ" onchange="updateMultiSelect('instruments')"><label for="i_å°è™Ÿ">å°è™Ÿ (Trumpet) ğŸº</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_é•·è™Ÿ" value="é•·è™Ÿ" onchange="updateMultiSelect('instruments')"><label for="i_é•·è™Ÿ">é•·è™Ÿ (Trombone) ğŸº</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_é•·ç¬›" value="é•·ç¬›" onchange="updateMultiSelect('instruments')"><label for="i_é•·ç¬›">é•·ç¬› (Flute) ğŸ¶</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_å–®ç°§ç®¡" value="å–®ç°§ç®¡" onchange="updateMultiSelect('instruments')"><label for="i_å–®ç°§ç®¡">å–®ç°§ç®¡ (Clarinet) ğŸ¶</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_å£ç´" value="å£ç´" onchange="updateMultiSelect('instruments')"><label for="i_å£ç´">å£ç´ (Harmonica) ğŸµ</label></div>
                        </div>
                        <div class="dropdown-group">
                            <div class="dropdown-group-label">ğŸ¥ æ‰“æ“Šæ¨‚å™¨</div>
                            <div class="dropdown-option"><input type="checkbox" id="i_çˆµå£«é¼“" value="çˆµå£«é¼“" onchange="updateMultiSelect('instruments')"><label for="i_çˆµå£«é¼“">çˆµå£«é¼“ (Drums) ğŸ¥</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_é›»å­é¼“" value="é›»å­é¼“" onchange="updateMultiSelect('instruments')"><label for="i_é›»å­é¼“">é›»å­é¼“ (Electronic Drums) ğŸ¥</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_é‚¦å“¥é¼“" value="é‚¦å“¥é¼“" onchange="updateMultiSelect('instruments')"><label for="i_é‚¦å“¥é¼“">é‚¦å“¥é¼“ (Bongos) ğŸ¥</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_åº·åŠ é¼“" value="åº·åŠ é¼“" onchange="updateMultiSelect('instruments')"><label for="i_åº·åŠ é¼“">åº·åŠ é¼“ (Congas) ğŸ¥</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_æœ¨ç®±é¼“" value="æœ¨ç®±é¼“" onchange="updateMultiSelect('instruments')"><label for="i_æœ¨ç®±é¼“">æœ¨ç®±é¼“ (Cajon) ğŸ“¦</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_éˆ´é¼“" value="éˆ´é¼“" onchange="updateMultiSelect('instruments')"><label for="i_éˆ´é¼“">éˆ´é¼“ (Tambourine) ğŸ””</label></div>
                        </div>
                        <div class="dropdown-group">
                            <div class="dropdown-group-label">ğŸ›ï¸ é›»å­/åˆæˆ</div>
                            <div class="dropdown-option"><input type="checkbox" id="i_åˆæˆè²æ–¯" value="åˆæˆè²æ–¯" onchange="updateMultiSelect('instruments')"><label for="i_åˆæˆè²æ–¯">åˆæˆè²æ–¯ (Synth Bass) ğŸ›ï¸</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_åˆæˆä¸»éŸ³" value="åˆæˆä¸»éŸ³" onchange="updateMultiSelect('instruments')"><label for="i_åˆæˆä¸»éŸ³">åˆæˆä¸»éŸ³ (Synth Lead) ğŸ›ï¸</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_é›»å­éŸ³æ•ˆ" value="é›»å­éŸ³æ•ˆ" onchange="updateMultiSelect('instruments')"><label for="i_é›»å­éŸ³æ•ˆ">é›»å­éŸ³æ•ˆ (Electronic FX) âš¡</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_808é¼“æ©Ÿ" value="808é¼“æ©Ÿ" onchange="updateMultiSelect('instruments')"><label for="i_808é¼“æ©Ÿ">808 é¼“æ©Ÿ (808 Drums) ğŸ¤–</label></div>
                        </div>
                        <div class="dropdown-group">
                            <div class="dropdown-group-label">ğŸ å‚³çµ±/æ°‘æ—</div>
                            <div class="dropdown-option"><input type="checkbox" id="i_äºŒèƒ¡" value="äºŒèƒ¡" onchange="updateMultiSelect('instruments')"><label for="i_äºŒèƒ¡">äºŒèƒ¡ ğŸ»</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_å¤ç®" value="å¤ç®" onchange="updateMultiSelect('instruments')"><label for="i_å¤ç®">å¤ç® ğŸ¼</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_çµç¶" value="çµç¶" onchange="updateMultiSelect('instruments')"><label for="i_çµç¶">çµç¶ ğŸµ</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_ç¬›å­" value="ç¬›å­" onchange="updateMultiSelect('instruments')"><label for="i_ç¬›å­">ç¬›å­ ğŸ¶</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_ä¸‰å‘³ç·š" value="ä¸‰å‘³ç·š" onchange="updateMultiSelect('instruments')"><label for="i_ä¸‰å‘³ç·š">ä¸‰å‘³ç·š (ä¸‰ç·š) ğŸ¸</label></div>
                            <div class="dropdown-option"><input type="checkbox" id="i_å°ºå…«" value="å°ºå…«" onchange="updateMultiSelect('instruments')"><label for="i_å°ºå…«">å°ºå…« ğŸ¶</label></div>
                        </div>
                        <div class="dropdown-actions">
                            <button type="button" class="btn-clear-all" onclick="clearAll('instruments')">æ¸…é™¤å…¨éƒ¨</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>ğŸ’¡ ç‰¹æ®Šéœ€æ±‚ï¼ˆé¸å¡«ï¼‰</label>
                <textarea id="requirements" placeholder="ä¾‹å¦‚ï¼šéœ€è¦å‰¯æ­Œé‡è¤‡ã€æƒ³è¦ rap æ®µè½ã€å¸Œæœ›æœ‰æ©‹æ®µ(bridge)ã€ç‰¹å®šæ„è±¡æˆ–è©å½™..."></textarea>
            </div>

            <!-- Suno é¢¨æ ¼æ¬„ä½ -->
            <div class="form-group">
                <label>ğŸ¨ Suno é¢¨æ ¼æè¿°ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰</label>
                <div class="style-output-box">
                    <h3>ğŸ“ é¢¨æ ¼æç¤ºè©</h3>
                    <div class="style-text" id="styleOutput">
                        <span style="color: #ccc;">é¸æ“‡éŸ³æ¨‚é¢¨æ ¼ã€æƒ…æ„ŸåŸºèª¿å’Œæ¨‚å™¨å¾Œï¼Œé¢¨æ ¼æè¿°å°‡è‡ªå‹•ç”Ÿæˆ...</span>
                    </div>
                    <button type="button" class="copy-style-btn" onclick="copyStyleToClipboard()">
                        ğŸ“‹ è¤‡è£½é¢¨æ ¼æè¿°çµ¦ Suno
                    </button>
                    <div class="style-feedback" id="styleFeedback"></div>
                </div>
            </div>


            <div class="button-group">
                <button class="random-btn" onclick="randomFill()">
                    ğŸ² AI éš¨æ©Ÿç”Ÿæˆ
                </button>
                <button id="generateBtn" onclick="generateLyrics()">
                    âœ¨ ç”Ÿæˆæ­Œè©
                </button>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>AI æ­£åœ¨ç‚ºä½ å‰µä½œæ­Œè©...</p>
        </div>

        <div class="result-section" id="resultSection">
            <div class="style-prompt-section" id="stylePromptSection" style="display: none;">
                <h3>ğŸ¨ Suno é¢¨æ ¼æç¤ºè©</h3>
                <div class="style-prompt-output" id="stylePromptOutput"></div>
                <button type="button" class="copy-style-prompt-btn" onclick="copyStylePrompt()">
                    ğŸ“‹ è¤‡è£½é¢¨æ ¼æç¤ºè©çµ¦ Suno
                </button>
            </div>
            <h2 style="color: #667eea; margin-bottom: 15px;">ğŸ¼ ç”Ÿæˆçš„æ­Œè©</h2>
            <div class="lyrics-output" id="lyricsOutput"></div>
            <div class="action-buttons">
                <button class="copy-btn" onclick="copyLyrics()">
                    ğŸ“‹ è¤‡è£½æ­Œè©
                </button>
                <button class="suno-btn" onclick="openSuno()">
                    ğŸµ å‰å¾€ Suno å‰µä½œ
                </button>
            </div>
            <div class="action-buttons" style="margin-top: 10px;">
                <button class="export-btn" onclick="exportLyrics()">
                    ğŸ’¾ åŒ¯å‡ºæª”æ¡ˆ
                </button>
                <button class="import-btn" onclick="document.getElementById('importFile').click()">
                    ğŸ“‚ åŒ¯å…¥æª”æ¡ˆ
                </button>
            </div>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importLyrics(event)">
        </div>

        <div class="tips">
            <h3>ğŸ’¡ ä½¿ç”¨æç¤º</h3>
            <ul>
                <li>ç”Ÿæˆçš„æ­Œè©å·²åŒ…å« Suno æ¨™æº–æ ¼å¼æ¨™ç±¤ ([Verse], [Chorus], [Bridge] ç­‰)</li>
                <li>è¤‡è£½æ­Œè©å¾Œï¼Œç›´æ¥è²¼åˆ° Suno AI çš„æ­Œè©æ¬„ä½å³å¯</li>
                <li>å»ºè­°åœ¨ Suno ä¸­é¸æ“‡å°æ‡‰çš„éŸ³æ¨‚é¢¨æ ¼ä»¥ç²å¾—æœ€ä½³æ•ˆæœ</li>
                <li>å¯ä»¥å¤šæ¬¡ç”Ÿæˆï¼Œé¸æ“‡æœ€æ»¿æ„çš„ç‰ˆæœ¬</li>
                <li><strong>ğŸ”„ è‡ªå‹•å„²å­˜ï¼š</strong>é‡æ–°æ•´ç†é é¢ä¸æœƒæ¸…ç©ºï¼Œæ‰€æœ‰è¨­å®šè‡ªå‹•ä¿ç•™</li>
                <li><strong>ğŸ’¾ åŒ¯å‡º/åŒ¯å…¥ï¼š</strong>å¯ä»¥ä¿å­˜æ­Œè©å’Œè¨­å®šç‚º JSON æª”æ¡ˆï¼Œæ–¹ä¾¿åˆ†äº«æˆ–å‚™ä»½</li>
            </ul>
        </div>
    </div>

    <!-- API è¨­å®šæŒ‰éˆ• -->
    <button class="settings-btn" onclick="openApiModal()" title="API è¨­å®š">
        âš™ï¸
    </button>

    <!-- API é‡‘é‘°æ¨¡æ…‹è¦–çª— -->
    <div id="apiModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ”‘ API é‡‘é‘°è¨­å®š</h2>
                <p>è«‹è¼¸å…¥æ‚¨çš„ Google Gemini API é‡‘é‘°</p>
            </div>
            
            <div class="info-box">
                <p><strong>å¦‚ä½•å–å¾— API é‡‘é‘°ï¼Ÿ</strong></p>
                <p>1. å‰å¾€ <a href="https://aistudio.google.com/apikey" target="_blank">Google AI Studio</a></p>
                <p>2. ç™»å…¥ Google å¸³è™Ÿ</p>
                <p>3. é»æ“Šã€ŒCreate API Keyã€å»ºç«‹é‡‘é‘°</p>
                <p>4. è¤‡è£½é‡‘é‘°ä¸¦è²¼åˆ°ä¸‹æ–¹æ¬„ä½</p>
            </div>

            <div class="modal-body">
                <input 
                    type="password" 
                    id="apiKeyInput" 
                    class="modal-input" 
                    placeholder="AIza..."
                    autocomplete="off"
                >
            </div>

            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeApiModal()">
                    å–æ¶ˆ
                </button>
                <button class="modal-btn modal-btn-primary" onclick="saveApiKey()">
                    å„²å­˜
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== IndexedDB åˆå§‹åŒ–å’Œç®¡ç† =====
        let db = null;
        const DB_NAME = 'LyricsGeneratorDB';
        const STORE_NAME = 'formState';
        const API_KEY_STORE = 'apiKeyStore';

        // åˆå§‹åŒ– IndexedDB
        function initIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, 1);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
                
                request.onupgradeneeded = (event) => {
                    const database = event.target.result;
                    if (!database.objectStoreNames.contains(STORE_NAME)) {
                        database.createObjectStore(STORE_NAME);
                    }
                    if (!database.objectStoreNames.contains(API_KEY_STORE)) {
                        database.createObjectStore(API_KEY_STORE);
                    }
                };
            });
        }

        // ä¿å­˜æ•¸æ“šåˆ° IndexedDB
        function saveToIndexedDB(storeName, key, data) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject(new Error('IndexedDB æœªåˆå§‹åŒ–'));
                    return;
                }
                
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.put(data, key);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(data);
            });
        }

        // å¾ IndexedDB è®€å–æ•¸æ“š
        function getFromIndexedDB(storeName, key) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject(new Error('IndexedDB æœªåˆå§‹åŒ–'));
                    return;
                }
                
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.get(key);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
            });
        }

        // æ¸…é™¤ IndexedDB ä¸­çš„æ•¸æ“š
        function clearIndexedDB(storeName, key) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject(new Error('IndexedDB æœªåˆå§‹åŒ–'));
                    return;
                }
                
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.delete(key);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve();
            });
        }


        const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent';
        let API_KEY = localStorage.getItem('gemini_api_key') || '';

        // å¤šé¸ä¸‹æ‹‰é¸å–®ç‹€æ…‹
        let openDropdown = null;

        // ç²å–é¸ä¸­çš„å€¼
        function getSelectedValues(type) {
            const prefix = type === 'genre' ? 'g_' : type === 'mood' ? 'm_' : 'i_';
            const container = document.getElementById(`${type}Dropdown`);
            const checkboxes = container.querySelectorAll('input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // åˆ‡æ›ä¸‹æ‹‰é¸å–®
        function toggleDropdown(type) {
            const dropdown = document.getElementById(`${type}Dropdown`);
            const arrow = document.getElementById(`${type}Arrow`);
            const display = dropdown.previousElementSibling;

            // å¦‚æœé»æ“Šçš„æ˜¯å·²é–‹å•Ÿçš„ä¸‹æ‹‰é¸å–®ï¼Œå‰‡é—œé–‰
            if (openDropdown === type) {
                dropdown.classList.remove('show');
                arrow.classList.remove('open');
                display.classList.remove('active');
                openDropdown = null;
            } else {
                // é—œé–‰å…¶ä»–é–‹å•Ÿçš„ä¸‹æ‹‰é¸å–®
                if (openDropdown) {
                    document.getElementById(`${openDropdown}Dropdown`).classList.remove('show');
                    document.getElementById(`${openDropdown}Arrow`).classList.remove('open');
                    document.getElementById(`${openDropdown}Dropdown`).previousElementSibling.classList.remove('active');
                }
                
                // é–‹å•Ÿæ–°çš„ä¸‹æ‹‰é¸å–®
                dropdown.classList.add('show');
                arrow.classList.add('open');
                display.classList.add('active');
                openDropdown = type;
            }
        }

        // æ›´æ–°é¡¯ç¤ºçš„å·²é¸é …ç›®
        function updateMultiSelect(type) {
            const selectedContainer = document.getElementById(`${type}Selected`);
            const countSpan = document.getElementById(`${type}Count`);
            const selectedValues = getSelectedValues(type);

            if (selectedValues.length === 0) {
                const placeholderText = type === 'genre' ? 'é»æ“Šé¸æ“‡é¢¨æ ¼...' : 
                                       type === 'mood' ? 'é»æ“Šé¸æ“‡æƒ…æ„Ÿ...' : 'é»æ“Šé¸æ“‡æ¨‚å™¨...';
                selectedContainer.innerHTML = `<span class="multi-select-placeholder">${placeholderText}</span>`;
                countSpan.textContent = '';
            } else {
                selectedContainer.innerHTML = selectedValues.map(value => 
                    `<span class="selected-tag">
                        ${value}
                        <span class="remove-tag" onclick="removeSelection(event, '${type}', '${value}')">Ã—</span>
                    </span>`
                ).join('');
                countSpan.textContent = `(å·²é¸ ${selectedValues.length} é …)`;
            }

            // æ›´æ–°é¸é …æ¨£å¼
            updateOptionStyles(type);
            
            // ä¿å­˜ç‹€æ…‹
            saveFormState();
        }

        // ç”Ÿæˆ Suno é¢¨æ ¼æè¿°
        
        // ç”Ÿæˆ Suno é¢¨æ ¼æç¤ºè©ï¼ˆä½¿ç”¨ AIï¼‰
        async 
        // ä¸­æ–‡å¸¸ç”¨å­—æ‹¼éŸ³æ˜ å°„è¡¨ï¼ˆç°¡åŒ–ç‰ˆï¼ŒåŒ…å«å¸¸è¦‹æ­Œè©ç”¨å­—ï¼‰
        const chinesePinyinMap = {
            'æ„›': 'Ã i', 'å¿ƒ': 'xÄ«n', 'å¤¢': 'mÃ¨ng', 'å…‰': 'guÄng', 'å¤œ': 'yÃ¨', 'æ˜Ÿ': 'xÄ«ng',
            'æœˆ': 'yuÃ¨', 'é¢¨': 'fÄ“ng', 'é›¨': 'yÇ”', 'é›ª': 'xuÄ›', 'èŠ±': 'huÄ', 'æµ·': 'hÇi',
            'å±±': 'shÄn', 'æ°´': 'shuÇ', 'ç«': 'huÇ’', 'å¤©': 'tiÄn', 'åœ°': 'dÃ¬', 'äºº': 'rÃ©n',
            'ç”Ÿ': 'shÄ“ng', 'æ­»': 'sÇ', 'ä¾†': 'lÃ¡i', 'å»': 'qÃ¹', 'èªª': 'shuÅ', 'å”±': 'chÃ ng',
            'ç¬‘': 'xiÃ o', 'å“­': 'kÅ«', 'æ·š': 'lÃ¨i', 'ç—›': 'tÃ©nÉ¡', 'æ¨‚': 'lÃ¨', 'æ‚²': 'bÄ“i',
            'å–œ': 'xÇ', 'æ€’': 'nÃ¹', 'å“€': 'Äi', 'ç¾': 'mÄ›i', 'é†œ': 'chÇ’u', 'å¥½': 'hÇo',
            'å£': 'huÃ i', 'å¤§': 'dÃ ', 'å°': 'xiÇo', 'å¤š': 'duÅ', 'å°‘': 'shÇo', 'é•·': 'chÃ¡ng',
            'çŸ­': 'duÇn', 'é«˜': 'gÄo', 'ä½': 'dÄ«', 'å¿«': 'kuÃ i', 'æ…¢': 'mÃ n', 'å†·': 'lÄ›ng',
            'ç†±': 'rÃ¨', 'ä¹¾': 'gÄn', 'æ¿•': 'shÄ«', 'äº®': 'liÃ ng', 'æš—': 'Ã n', 'æ–°': 'xÄ«n',
            'èˆŠ': 'jiÃ¹', 'çœŸ': 'zhÄ“n', 'å‡': 'jiÇ', 'å–„': 'shÃ n', 'æƒ¡': 'Ã¨', 'æˆ‘': 'wÇ’',
            'ä½ ': 'nÇ', 'ä»–': 'tÄ', 'å¥¹': 'tÄ', 'æ˜¯': 'shÃ¬', 'æœ‰': 'yÇ’u', 'åœ¨': 'zÃ i',
            'è¢«': 'bÃ¨i', 'æŠŠ': 'bÇ', 'çµ¦': 'gÄ›i', 'å’Œ': 'hÃ©', 'æˆ–': 'huÃ²', 'åŠ': 'jÃ­',
            'èˆ‡': 'yÇ”', 'ä½†': 'dÃ n', 'å»': 'quÃ¨', 'å› ': 'yÄ«n', 'æœ': 'guÇ’', 'æ‰€': 'suÇ’',
            'ä»¥': 'yÇ', 'å¦‚': 'rÃº', 'è‹¥': 'ruÃ²', 'ç‚º': 'wÃ©i', 'è®“': 'rÃ ng', 'å«': 'jiÃ o',
            'ä½¿': 'shÇ', 'ä»¤': 'lÃ¬ng', 'æƒ³': 'xiÇng', 'çŸ¥': 'zhÄ«', 'è¦º': 'jiÃ o', 'çœ‹': 'kÃ n',
            'è½': 'tÄ«ng', 'è': 'wÃ©n', 'å˜—': 'chÃ¡ng', 'è§¸': 'chÃ¹', 'æ„Ÿ': 'gÇn', 'å—': 'shÃ²u',
            'å¾—': 'de', 'å¤±': 'shÄ«', 'æ‰¾': 'zhÇo', 'å°‹': 'xÃºn', 'æ±‚': 'qiÃº', 'è¦': 'yÃ o',
            'éœ€': 'xÅ«', 'å¿…': 'bÃ¬', 'èƒ½': 'nÃ©ng', 'æœƒ': 'huÃ¬', 'å¯': 'kÄ›', 'æ‡‰': 'yÄ«ng',
            'è©²': 'gÄi', 'ç•¶': 'dÄng', 'åš': 'zuÃ²', 'ä½œ': 'zuÃ²', 'è¡Œ': 'xÃ­ng', 'èµ°': 'zÇ’u',
            'è·‘': 'pÇo', 'è·³': 'tiÃ o', 'é£›': 'fÄ“i', 'æ¸¸': 'yÃ³u', 'çˆ¬': 'pÃ¡', 'å': 'zuÃ²',
            'ç«™': 'zhÃ n', 'èºº': 'tÇng', 'ç¡': 'shuÃ¬', 'é†’': 'xÇng', 'åƒ': 'chÄ«', 'å–': 'hÄ“',
            'ç©¿': 'chuÄn', 'è„«': 'tuÅ', 'æ´—': 'xÇ', 'æ“¦': 'cÄ', 'æƒ': 'sÇo', 'æ‹¿': 'nÃ¡',
            'æ”¾': 'fÃ ng', 'æ‰”': 'rÄ“ng', 'æ‰“': 'dÇ', 'è¸¢': 'tÄ«', 'æ¨': 'tuÄ«', 'æ‹‰': 'lÄ',
            'æŠ±': 'bÃ o', 'æ‘¸': 'mÅ', 'è¦ª': 'qÄ«n', 'å»': 'wÄ›n', 'æ“': 'yÅng', 'æ¡': 'wÃ²',
            'ç‰½': 'qiÄn', 'é–‹': 'kÄi', 'é—œ': 'guÄn', 'é€²': 'jÃ¬n', 'å‡º': 'chÅ«', 'ä¸Š': 'shÃ ng',
            'ä¸‹': 'xiÃ ', 'å‰': 'qiÃ¡n', 'å¾Œ': 'hÃ²u', 'å·¦': 'zuÇ’', 'å³': 'yÃ²u', 'ä¸­': 'zhÅng',
            'é–“': 'jiÄn', 'å…§': 'nÃ¨i', 'å¤–': 'wÃ i', 'è£¡': 'lÇ', 'é‚Š': 'biÄn', 'é ­': 'tÃ³u',
            'å°¾': 'wÄ›i', 'å§‹': 'shÇ', 'çµ‚': 'zhÅng', 'åˆ': 'chÅ«', 'æœ«': 'mÃ²', 'æ—©': 'zÇo',
            'æ™š': 'wÇn', 'ä»Š': 'jÄ«n', 'æ˜¨': 'zuÃ³', 'æ˜': 'mÃ­ng', 'é': 'guÃ²', 'æœª': 'wÃ¨i',
            'æ˜¥': 'chÅ«n', 'å¤': 'xiÃ ', 'ç§‹': 'qiÅ«', 'å†¬': 'dÅng', 'å­£': 'jÃ¬', 'ç¯€': 'jiÃ©',
            'å¹´': 'niÃ¡n', 'æ—¥': 'rÃ¬', 'æ™‚': 'shÃ­', 'åˆ†': 'fÄ“n', 'ç§’': 'miÇo', 'ä¸€': 'yÄ«',
            'äºŒ': 'Ã¨r', 'ä¸‰': 'sÄn', 'å››': 'sÃ¬', 'äº”': 'wÇ”', 'å…­': 'liÃ¹', 'ä¸ƒ': 'qÄ«',
            'å…«': 'bÄ', 'ä¹': 'jiÇ”', 'å': 'shÃ­', 'ç™¾': 'bÇi', 'åƒ': 'qiÄn', 'è¬': 'wÃ n',
            'å®¶': 'jiÄ', 'æˆ¿': 'fÃ¡ng', 'å±‹': 'wÅ«', 'æ¨“': 'lÃ³u', 'é–€': 'mÃ©n', 'çª—': 'chuÄng',
            'åºŠ': 'chuÃ¡ng', 'æ¡Œ': 'zhuÅ', 'æ¤…': 'yÇ', 'è¡£': 'yÄ«', 'è¤²': 'kÃ¹', 'è£™': 'qÃºn',
            'é‹': 'xiÃ©', 'å¸½': 'mÃ o', 'æ‰‹': 'shÇ’u', 'è…³': 'jiÇo', 'é ­': 'tÃ³u', 'è‡‰': 'liÇn',
            'çœ¼': 'yÇn', 'é¼»': 'bÃ­', 'è€³': 'Ä›r', 'å˜´': 'zuÇ', 'ç‰™': 'yÃ¡', 'èˆŒ': 'shÃ©',
            'å–‰': 'hÃ³u', 'å¿ƒ': 'xÄ«n', 'è‚º': 'fÃ¨i', 'è‚': 'gÄn', 'è…': 'shÃ¨n', 'èƒƒ': 'wÃ¨i',
            'è¡€': 'xuÃ¨', 'æ·š': 'lÃ¨i', 'æ±—': 'hÃ n', 'éª¨': 'gÇ”', 'è‚‰': 'rÃ²u', 'çš®': 'pÃ­',
            'æ¯›': 'mÃ¡o', 'é«®': 'fÃ ', 'é¬š': 'xÅ«', 'çœ‰': 'mÃ©i', 'é¬': 'hÃº', 'é¬š': 'xÅ«'
        };

        // å°‡ä¸­æ–‡è½‰æ›ç‚ºæ‹¼éŸ³ï¼ˆç°¡åŒ–ç‰ˆï¼‰
        function chineseToPinyin(text) {
            let result = '';
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                if (chinesePinyinMap[char]) {
                    result += chinesePinyinMap[char] + ' ';
                } else if (/[ä¸€-é¿¿]/.test(char)) {
                    result += char + ' ';
                } else {
                    result += char;
                }
            }
            return result.trim();
        }

        function generateStylePrompt(theme, genres, moods, instruments, language, voice, duration, requirements) {
            if (!API_KEY) {
                console.error('API_KEY æœªè¨­å®š');
                return null;
            }

            const genreText = genres.length > 0 ? genres.join(', ') : 'æµè¡Œæ–æ»¾';
            const moodText = moods.length > 0 ? moods.join(', ') : 'å‚·æ„Ÿ';
            const instrumentText = instruments.length > 0 ? instruments.join(', ') : 'å‰ä»–';

            const prompt = `ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„éŸ³æ¨‚è£½ä½œäººã€‚è«‹æ ¹æ“šä»¥ä¸‹ä¿¡æ¯ï¼Œç‚º Suno AI ç”Ÿæˆä¸€å€‹ç²¾ç¢ºçš„é¢¨æ ¼æç¤ºè©ï¼ˆStyle Promptï¼‰ã€‚

æ­Œæ›²ä¸»é¡Œï¼š${theme}
éŸ³æ¨‚é¢¨æ ¼ï¼š${genreText}
æƒ…æ„ŸåŸºèª¿ï¼š${moodText}
ä¸»è¦æ¨‚å™¨ï¼š${instrumentText}
èªè¨€ï¼š${language}
æ¼”å”±è²éŸ³ï¼š${voice}
æ­Œæ›²é•·åº¦ï¼š${duration}
${requirements ? `ç‰¹æ®Šéœ€æ±‚ï¼š${requirements}` : ''}

è«‹ç”Ÿæˆä¸€å€‹ç°¡æ½”è€Œç²¾ç¢ºçš„ Suno AI é¢¨æ ¼æç¤ºè©ï¼Œæ ¼å¼æ‡‰è©²æ˜¯ï¼š
[é¢¨æ ¼], [æƒ…æ„Ÿ], [æ¨‚å™¨], [å…¶ä»–ç‰¹å¾µ]

ä¾‹å¦‚ï¼š
- "pop rock, melancholic, featuring guitar and piano, emotional vocals"
- "hip-hop trap, confident and energetic, 808 drums and synth bass, rap vocals"
- "indie folk, nostalgic and dreamy, acoustic guitar and strings, soft vocals"

è«‹ç›´æ¥è¼¸å‡ºé¢¨æ ¼æç¤ºè©ï¼Œä¸éœ€è¦é¡å¤–èªªæ˜ã€‚`;

            // å¦‚æœæ˜¯ä¸­æ–‡æ­Œæ›²ï¼Œæ·»åŠ ä¸­æ–‡ç™¼éŸ³æŒ‡å°
            if (language.includes('ä¸­') || language === 'ä¸­è‹±æ··åˆ') {
                const themePinyin = chineseToPinyin(theme);
                prompt += `

ã€ä¸­æ–‡ç™¼éŸ³æŒ‡å°ã€‘
æ­Œæ›²ä¸»é¡Œçš„æ‹¼éŸ³ï¼š${themePinyin}

è«‹åœ¨ç”Ÿæˆçš„é¢¨æ ¼æç¤ºè©ä¸­æ·»åŠ ä»¥ä¸‹ä¿¡æ¯ï¼š
1. æ˜ç¢ºæŒ‡å‡ºé€™æ˜¯ä¸­æ–‡æ­Œæ›²ï¼ˆChinese song / Mandarin lyricsï¼‰
2. æ·»åŠ ç™¼éŸ³é¢¨æ ¼æè¿°ï¼Œä¾‹å¦‚ï¼š
   - "clear Mandarin pronunciation with proper tones"
   - "smooth and flowing Mandarin vocals"
   - "emotional Mandarin singing with correct intonation"
   - "crisp and articulate Chinese vocals"
3. ç¢ºä¿ Suno AI èƒ½å¤ æ­£ç¢ºç™¼éŸ³ä¸­æ–‡æ­Œè©

æœ€çµ‚çš„é¢¨æ ¼æç¤ºè©æ‡‰è©²åŒ…å«ç™¼éŸ³æŒ‡å°ï¼Œä¾‹å¦‚ï¼š
- "pop rock with clear Mandarin pronunciation, emotional vocals with proper tones, featuring guitar and piano"
- "melancholic Chinese ballad, smooth flowing Mandarin vocals with correct intonation, featuring piano"

è«‹ç›´æ¥è¼¸å‡ºåŒ…å«ç™¼éŸ³æŒ‡å°çš„é¢¨æ ¼æç¤ºè©ã€‚`;
            }

            try {
                const response = await fetch(\`\${API_URL}?key=\${API_KEY}\`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 256,
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('API è«‹æ±‚å¤±æ•—');
                }

                const data = await response.json();
                const stylePrompt = data.candidates[0].content.parts[0].text.trim();
                return stylePrompt;
            } catch (error) {
                console.error('ç”Ÿæˆé¢¨æ ¼æç¤ºè©å¤±æ•—:', error);
                return null;
            }
        }

        // è¤‡è£½é¢¨æ ¼æç¤ºè©åˆ°å‰ªè²¼æ¿
        function copyStylePrompt() {
            const stylePrompt = document.getElementById('stylePromptOutput').textContent;
            
            if (!stylePrompt) {
                alert('é¢¨æ ¼æç¤ºè©ç‚ºç©ºï¼');
                return;
            }
            
            navigator.clipboard.writeText(stylePrompt).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'âœ… å·²è¤‡è£½ï¼';
                btn.style.background = 'rgba(76, 175, 80, 0.5)';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            }).catch(err => {
                // é™ç´šæ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = stylePrompt;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'âœ… å·²è¤‡è£½ï¼';
                btn.style.background = 'rgba(76, 175, 80, 0.5)';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            });
        }

        function generateStyleDescription() {
            const genres = getSelectedValues('genre');
            const moods = getSelectedValues('mood');
            const instruments = getSelectedValues('instruments');
            
            let styleText = '';
            
            // æ§‹å»ºé¢¨æ ¼æè¿°
            if (genres.length > 0) {
                styleText += genres.join(', ');
            }
            
            if (moods.length > 0) {
                if (styleText) styleText += ', ';
                styleText += moods.join(', ');
            }
            
            if (instruments.length > 0) {
                if (styleText) styleText += ', featuring ';
                styleText += instruments.join(', ');
            }
            
            if (!styleText) {
                document.getElementById('styleOutput').innerHTML = '<span style="color: #ccc;">é¸æ“‡éŸ³æ¨‚é¢¨æ ¼ã€æƒ…æ„ŸåŸºèª¿å’Œæ¨‚å™¨å¾Œï¼Œé¢¨æ ¼æè¿°å°‡è‡ªå‹•ç”Ÿæˆ...</span>';
                return '';
            }
            
            document.getElementById('styleOutput').textContent = styleText;
            return styleText;
        }

        // è¤‡è£½é¢¨æ ¼æè¿°åˆ°å‰ªè²¼æ¿
        function copyStyleToClipboard() {
            const styleText = document.getElementById('styleOutput').textContent;
            
            if (!styleText || styleText.includes('é¸æ“‡')) {
                alert('è«‹å…ˆé¸æ“‡éŸ³æ¨‚é¢¨æ ¼ã€æƒ…æ„ŸåŸºèª¿æˆ–æ¨‚å™¨ï¼');
                return;
            }
            
            navigator.clipboard.writeText(styleText).then(() => {
                const feedback = document.getElementById('styleFeedback');
                feedback.textContent = 'âœ… å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼';
                feedback.style.color = '#4CAF50';
                
                setTimeout(() => {
                    feedback.textContent = '';
                }, 2000);
            }).catch(err => {
                // é™ç´šæ–¹æ¡ˆï¼šä½¿ç”¨èˆŠæ–¹æ³•
                const textArea = document.createElement('textarea');
                textArea.value = styleText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                const feedback = document.getElementById('styleFeedback');
                feedback.textContent = 'âœ… å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼';
                feedback.style.color = '#4CAF50';
                
                setTimeout(() => {
                    feedback.textContent = '';
                }, 2000);
            });
        }


        // æ›´æ–°é¸é …çš„é¸ä¸­æ¨£å¼
        function updateOptionStyles(type) {
            const container = document.getElementById(`${type}Dropdown`);
            const options = container.querySelectorAll('.dropdown-option');
            options.forEach(option => {
                const checkbox = option.querySelector('input[type="checkbox"]');
                if (checkbox.checked) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
        }

        // ç§»é™¤å·²é¸é …ç›®
        function removeSelection(event, type, value) {
            event.stopPropagation();
            const prefix = type === 'genre' ? 'g_' : type === 'mood' ? 'm_' : 'i_';
            const checkbox = document.getElementById(`${prefix}${value}`);
            if (checkbox) {
                checkbox.checked = false;
                updateMultiSelect(type);
            }
        }

        // æ¸…é™¤å…¨éƒ¨é¸æ“‡
        function clearAll(type) {
            const container = document.getElementById(`${type}Dropdown`);
            const checkboxes = container.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
            updateMultiSelect(type);
        }

        // é»æ“Šå¤–éƒ¨é—œé–‰ä¸‹æ‹‰é¸å–®
        document.addEventListener('click', function(event) {
            if (openDropdown) {
                const container = document.getElementById(`${openDropdown}Container`);
                if (!container.contains(event.target)) {
                    const dropdown = document.getElementById(`${openDropdown}Dropdown`);
                    const arrow = document.getElementById(`${openDropdown}Arrow`);
                    const display = dropdown.previousElementSibling;
                    
                    dropdown.classList.remove('show');
                    arrow.classList.remove('open');
                    display.classList.remove('active');
                    openDropdown = null;
                }
            }
        });

        // é˜»æ­¢ä¸‹æ‹‰é¸å–®å…§éƒ¨é»æ“Šäº‹ä»¶å†’æ³¡
        document.querySelectorAll('.multi-select-dropdown').forEach(dropdown => {
            dropdown.addEventListener('click', function(event) {
                event.stopPropagation();
            });
        });

        // éš¨æ©Ÿä¸»é¡Œåº«
        const randomThemes = [
            'å¤±æˆ€çš„ç—›è‹¦', 'è¿½é€å¤¢æƒ³', 'é’æ˜¥å›æ†¶', 'å‹æƒ…çš„çè²´', 'æ„›æƒ…çš„ç¾å¥½',
            'å­¤ç¨çš„å¤œæ™š', 'é‡æ–°å‡ºç™¼', 'å®¶äººçš„æº«æš–', 'åŸå¸‚çš„å–§å›‚', 'é„‰æ‘çš„å¯§éœ',
            'æ™‚å…‰æµé€', 'å‹‡æ•¢å‰è¡Œ', 'æ”¾æ‰‹é‡‹æ‡·', 'é‡é€¢çš„å–œæ‚…', 'é›¢åˆ¥çš„å‚·æ„Ÿ',
            'è‡ªæˆ‘æ¢ç´¢', 'æ˜Ÿç©ºä¸‹çš„ç´„å®š', 'é›¨ä¸­æ¼«æ­¥', 'å¤æ—¥æˆ€æ›²', 'å†¬å­£æˆ€æ­Œ',
            'ç•¢æ¥­å­£', 'å·¥ä½œå£“åŠ›', 'æ·±å¤œé£Ÿå ‚', 'å’–å•¡èˆ‡éŸ³æ¨‚', 'æµ·é‚Šçš„å›æ†¶',
            'ç«¥å¹´å¾€äº‹', 'æˆé•·çš„ç…©æƒ±', 'æ„›çš„å‘Šç™½', 'åˆ†æ‰‹å¾Œçš„é‡‹ç„¶', 'é‡æ–°æ„›ä¸Šè‡ªå·±',
            'æ—…è¡Œçš„æ„ç¾©', 'æ‰¾å›åˆå¿ƒ', 'æ°¸ä¸æ”¾æ£„', 'é»‘æš—ä¸­çš„å…‰', 'å¸Œæœ›çš„ç¨®å­',
            'è¿·å¤±çš„éˆé­‚', 'é‡ç”Ÿçš„åŠ›é‡', 'æ‰¿è«¾èˆ‡èª“è¨€', 'ç ´ç¢çš„å¤¢', 'æ–°çš„é–‹å§‹',
            'åˆå¤œçš„æ€å¿µ', 'æ™¨æ›¦çš„å¸Œæœ›', 'è½æ—¥çš„æº«æŸ”', 'æœˆå…‰ä¸‹çš„ç§˜å¯†', 'é¢¨ä¸­çš„è‡ªç”±'
        ];

        // å„²å­˜è¡¨å–®ç‹€æ…‹
        async function saveFormState() {
            const formState = {
                theme: document.getElementById('theme').value,
                genre: getSelectedValues('genre'),
                mood: getSelectedValues('mood'),
                instruments: getSelectedValues('instruments'),
                language: document.getElementById('language').value,
                voice: document.getElementById('voice').value,
                duration: document.getElementById('duration').value,
                count: document.getElementById('count').value,
                requirements: document.getElementById('requirements').value,
                lyrics: document.getElementById('lyricsOutput').textContent
            };
            try {
                await saveToIndexedDB(STORE_NAME, 'formState', formState);
            } catch (e) {
                console.error('ä¿å­˜è¡¨å–®ç‹€æ…‹åˆ° IndexedDB å¤±æ•—:', e);
                // é™ç´šæ–¹æ¡ˆï¼šå˜—è©¦ä½¿ç”¨ localStorage
                try {
                    localStorage.setItem('lyrics_form_state', JSON.stringify(formState));
                } catch (e2) {
                    console.error('localStorage ä¹Ÿå¤±æ•—:', e2);
                }
            }
        }

        // æ¢å¾©è¡¨å–®ç‹€æ…‹
        async function restoreFormState() {
            try {
                const formState = await getFromIndexedDB(STORE_NAME, 'formState');
                if (!formState) {
                    // å˜—è©¦å¾ localStorage é·ç§»æ•¸æ“š
                    const savedState = localStorage.getItem('lyrics_form_state');
                    if (savedState) {
                        const migratedState = JSON.parse(savedState);
                        await saveToIndexedDB(STORE_NAME, 'formState', migratedState);
                        restoreStateToForm(migratedState);
                        localStorage.removeItem('lyrics_form_state');
                    }
                    return;
                }
                
                restoreStateToForm(formState);
            } catch (e) {
                console.error('æ¢å¾©è¡¨å–®ç‹€æ…‹å¤±æ•—:', e);
                // é™ç´šæ–¹æ¡ˆï¼šå˜—è©¦å¾ localStorage è®€å–
                const savedState = localStorage.getItem('lyrics_form_state');
                if (savedState) {
                    try {
                        const formState = JSON.parse(savedState);
                        restoreStateToForm(formState);
                    } catch (e2) {
                        console.error('localStorage æ¢å¾©ä¹Ÿå¤±æ•—:', e2);
                    }
                }
            }
        }

        // å°‡ç‹€æ…‹æ¢å¾©åˆ°è¡¨å–®
        function restoreStateToForm(formState) {
            if (!formState) return;
            
            document.getElementById('theme').value = formState.theme || '';
            
            // æ¢å¾©å¤šé¸çš„é¢¨æ ¼
            if (formState.genre && Array.isArray(formState.genre)) {
                formState.genre.forEach(value => {
                    const checkbox = document.getElementById(`g_${value}`);
                    if (checkbox) checkbox.checked = true;
                });
                updateMultiSelect('genre');
            }
            
            // æ¢å¾©å¤šé¸çš„æƒ…æ„Ÿ
            if (formState.mood && Array.isArray(formState.mood)) {
                formState.mood.forEach(value => {
                    const checkbox = document.getElementById(`m_${value}`);
                    if (checkbox) checkbox.checked = true;
                });
                updateMultiSelect('mood');
            }
            
            // æ¢å¾©å¤šé¸çš„æ¨‚å™¨
            if (formState.instruments && Array.isArray(formState.instruments)) {
                formState.instruments.forEach(value => {
                    const checkbox = document.getElementById(`i_${value}`);
                    if (checkbox) checkbox.checked = true;
                });
                updateMultiSelect('instruments');
            }
            
            document.getElementById('language').value = formState.language || 'ä¸­æ–‡';
            document.getElementById('voice').value = formState.voice || 'ç”·è²';
            document.getElementById('duration').value = formState.duration || 'æ¨™æº– (3-3.5åˆ†é˜)';
            document.getElementById('count').value = formState.count || '1';
            document.getElementById('requirements').value = formState.requirements || '';
            
            if (formState.lyrics) {
                document.getElementById('lyricsOutput').textContent = formState.lyrics;
                document.getElementById('resultSection').classList.add('show');
            }
        }

        // ç›£è½è¡¨å–®è®ŠåŒ–
        function setupAutoSave() {
            const inputs = document.querySelectorAll('#theme, #language, #voice, #duration, #count, #requirements');
            inputs.forEach(input => {
                input.addEventListener('change', saveFormState);
                input.addEventListener('input', saveFormState);
            
            // ç›£è½å¤šé¸æ¡†è®ŠåŒ–ä»¥æ›´æ–°é¢¨æ ¼æè¿°
            const multiSelects = document.querySelectorAll('.multi-select-dropdown input[type="checkbox"]');
            multiSelects.forEach(checkbox => {
                checkbox.addEventListener('change', generateStyleDescription);
            });});
        }

        // éš¨æ©Ÿå¡«å……æ‰€æœ‰æ¬„ä½
        function randomFill() {
            // éš¨æ©Ÿé¸æ“‡ä¸»é¡Œ
            const randomTheme = randomThemes[Math.floor(Math.random() * randomThemes.length)];
            document.getElementById('theme').value = randomTheme;

            // æ¸…é™¤ç¾æœ‰é¸æ“‡
            clearAll('genre');
            clearAll('mood');
            clearAll('instruments');

            // éš¨æ©Ÿé¸æ“‡éŸ³æ¨‚é¢¨æ ¼ï¼ˆ1-2å€‹ï¼‰
            const genreCheckboxes = document.querySelectorAll('#genreDropdown input[type="checkbox"]');
            const genreArray = Array.from(genreCheckboxes);
            const numGenres = Math.random() > 0.6 ? 2 : 1;
            const shuffledGenres = genreArray.sort(() => 0.5 - Math.random());
            for (let i = 0; i < numGenres && i < shuffledGenres.length; i++) {
                shuffledGenres[i].checked = true;
            }
            updateMultiSelect('genre');

            // éš¨æ©Ÿé¸æ“‡æƒ…æ„ŸåŸºèª¿ï¼ˆ1-2å€‹ï¼‰
            const moodCheckboxes = document.querySelectorAll('#moodDropdown input[type="checkbox"]');
            const moodArray = Array.from(moodCheckboxes);
            const numMoods = Math.random() > 0.7 ? 2 : 1;
            const shuffledMoods = moodArray.sort(() => 0.5 - Math.random());
            for (let i = 0; i < numMoods && i < shuffledMoods.length; i++) {
                shuffledMoods[i].checked = true;
            }
            updateMultiSelect('mood');

            // éš¨æ©Ÿé¸æ“‡æ¨‚å™¨ï¼ˆ1-3å€‹ï¼‰
            const instrumentCheckboxes = document.querySelectorAll('#instrumentsDropdown input[type="checkbox"]');
            const instrumentArray = Array.from(instrumentCheckboxes);
            const numInstruments = Math.floor(Math.random() * 3) + 1;
            const shuffledInstruments = instrumentArray.sort(() => 0.5 - Math.random());
            for (let i = 0; i < numInstruments && i < shuffledInstruments.length; i++) {
                shuffledInstruments[i].checked = true;
            }
            updateMultiSelect('instruments');

            // éš¨æ©Ÿé¸æ“‡èªè¨€
            const languageSelect = document.getElementById('language');
            const randomLanguageIndex = Math.floor(Math.random() * languageSelect.options.length);
            languageSelect.selectedIndex = randomLanguageIndex;

            // éš¨æ©Ÿé¸æ“‡è²éŸ³
            const voiceSelect = document.getElementById('voice');
            const randomVoiceIndex = Math.floor(Math.random() * voiceSelect.options.length);
            voiceSelect.selectedIndex = randomVoiceIndex;

            // éš¨æ©Ÿé¸æ“‡æ­Œæ›²é•·åº¦
            const durationSelect = document.getElementById('duration');
            const randomDurationIndex = Math.floor(Math.random() * durationSelect.options.length);
            durationSelect.selectedIndex = randomDurationIndex;

            // éš¨æ©Ÿé¸æ“‡ç”Ÿæˆæ•¸é‡ï¼ˆ1-3é¦–ï¼‰
            const countSelect = document.getElementById('count');
            const randomCountIndex = Math.floor(Math.random() * 3);
            countSelect.selectedIndex = randomCountIndex;

            // æ¸…ç©ºç‰¹æ®Šéœ€æ±‚
            document.getElementById('requirements').value = '';

            // æ·»åŠ è¦–è¦ºåé¥‹
            const containers = document.querySelectorAll('.multi-select-display, .input-section input, .input-section select');
            containers.forEach(el => {
                el.style.background = '#fffbcc';
                setTimeout(() => {
                    el.style.background = '';
                }, 500);
            });

            saveFormState();
        }

        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥ API é‡‘é‘°ä¸¦æ¢å¾©è¡¨å–®ç‹€æ…‹
        window.onload = async function() {
            try {
                // åˆå§‹åŒ– IndexedDB
                await initIndexedDB();
                
                // å¾ IndexedDB æ¢å¾© API é‡‘é‘°
                const apiKeyData = await getFromIndexedDB(API_KEY_STORE, 'apiKey');
                if (apiKeyData && apiKeyData.key) {
                    API_KEY = apiKeyData.key;
                } else {
                    // å˜—è©¦å¾ localStorage é·ç§»
                    const localKey = localStorage.getItem('gemini_api_key');
                    if (localKey) {
                        API_KEY = localKey;
                        await saveToIndexedDB(API_KEY_STORE, 'apiKey', { key: localKey });
                        localStorage.removeItem('gemini_api_key');
                    }
                }
                
                if (!API_KEY) {
                    openApiModal();
                }
            } catch (e) {
                console.error('åˆå§‹åŒ–å¤±æ•—:', e);
                // é™ç´šæ–¹æ¡ˆï¼šä½¿ç”¨ localStorage
                const localKey = localStorage.getItem('gemini_api_key');
                if (localKey) {
                    API_KEY = localKey;
                } else if (!API_KEY) {
                    openApiModal();
                }
            }
            
            await restoreFormState();
            setupAutoSave();
        };

        function openApiModal() {
            const modal = document.getElementById('apiModal');
            const input = document.getElementById('apiKeyInput');
            input.value = API_KEY;
            modal.classList.add('show');
        }

        function closeApiModal() {
            const modal = document.getElementById('apiModal');
            modal.classList.remove('show');
        }

        async function saveApiKey() {
            const input = document.getElementById('apiKeyInput');
            const key = input.value.trim();

            if (!key) {
                alert('è«‹è¼¸å…¥ API é‡‘é‘°ï¼');
                return;
            }

            if (!key.startsWith('AIza')) {
                alert('API é‡‘é‘°æ ¼å¼ä¸æ­£ç¢ºï¼æ‡‰è©²ä»¥ "AIza" é–‹é ­');
                return;
            }

            API_KEY = key;
            try {
                await saveToIndexedDB(API_KEY_STORE, 'apiKey', { key: key });
            } catch (e) {
                console.error('ä¿å­˜ API é‡‘é‘°åˆ° IndexedDB å¤±æ•—:', e);
                // é™ç´šæ–¹æ¡ˆï¼šä½¿ç”¨ localStorage
                try {
                    localStorage.setItem('gemini_api_key', key);
                } catch (e2) {
                    console.error('localStorage ä¹Ÿå¤±æ•—:', e2);
                }
            }
            closeApiModal();
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'âœ… å·²å„²å­˜';
            btn.style.background = '#4caf50';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = '';
            }, 1500);
        }

        // é»æ“Šæ¨¡æ…‹è¦–çª—å¤–éƒ¨é—œé–‰
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('apiModal');
            if (event.target === modal) {
                closeApiModal();
            }
        });

        async function generateLyrics() {
            if (!API_KEY) {
                alert('è«‹å…ˆè¨­å®š API é‡‘é‘°ï¼');
                openApiModal();
                return;
            }

            const theme = document.getElementById('theme').value.trim();
            
            // ç²å–å¤šé¸çš„å€¼
            const selectedGenres = getSelectedValues('genre');
            const genre = selectedGenres.length > 0 ? selectedGenres.join(' + ') : 'æµè¡Œæ–æ»¾';
            
            const selectedMoods = getSelectedValues('mood');
            const mood = selectedMoods.length > 0 ? selectedMoods.join(' + ') : 'å‚·æ„Ÿæ†‚é¬±';
            
            const selectedInstruments = getSelectedValues('instruments');
            const instruments = selectedInstruments.length > 0 ? selectedInstruments.join('ã€') : 'ä¸æŒ‡å®š';
            
            const language = document.getElementById('language').value;
            const voice = document.getElementById('voice').value;
            const duration = document.getElementById('duration').value;
            const count = parseInt(document.getElementById('count').value);
            const requirements = document.getElementById('requirements').value.trim();

            if (!theme) {
                alert('è«‹è¼¸å…¥æ­Œæ›²ä¸»é¡Œï¼');
                return;
            }

            const generateBtn = document.getElementById('generateBtn');
            const loading = document.getElementById('loading');
            const resultSection = document.getElementById('resultSection');

            generateBtn.disabled = true;
            loading.classList.add('show');
            resultSection.classList.remove('show');

            let structureGuide = '';
            if (duration.includes('çŸ­ç‰ˆ')) {
                structureGuide = 'çµæ§‹å»ºè­°ï¼šIntro â†’ Verse 1 â†’ Chorus â†’ Verse 2 â†’ Chorus â†’ Outroï¼ˆç°¡çŸ­ç‰ˆæœ¬ï¼‰';
            } else if (duration.includes('æ¨™æº–')) {
                structureGuide = 'çµæ§‹å»ºè­°ï¼šIntro â†’ Verse 1 â†’ Chorus â†’ Verse 2 â†’ Chorus â†’ Bridge â†’ Chorus â†’ Outro';
            } else if (duration.includes('å®Œæ•´ç‰ˆ')) {
                structureGuide = 'çµæ§‹å»ºè­°ï¼šIntro â†’ Verse 1 â†’ Pre-Chorus â†’ Chorus â†’ Verse 2 â†’ Pre-Chorus â†’ Chorus â†’ Bridge â†’ Chorus â†’ Outro';
            } else {
                structureGuide = 'çµæ§‹å»ºè­°ï¼šIntro â†’ Verse 1 â†’ Pre-Chorus â†’ Chorus â†’ Verse 2 â†’ Pre-Chorus â†’ Chorus â†’ Bridge â†’ Solo/Instrumental â†’ Chorus â†’ Outroï¼ˆè±å¯Œç‰ˆæœ¬ï¼‰';
            }

            try {
                let allLyrics = [];

                for (let i = 0; i < count; i++) {
                    const prompt = `ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„æ­Œè©å‰µä½œäººã€‚è«‹æ ¹æ“šä»¥ä¸‹è¦æ±‚å‰µä½œä¸€é¦–å®Œæ•´çš„æ­Œè©ï¼š

ä¸»é¡Œï¼š${theme}
éŸ³æ¨‚é¢¨æ ¼ï¼š${genre}${selectedGenres.length > 1 ? 'ï¼ˆæ··æ­é¢¨æ ¼ï¼‰' : ''}
æƒ…æ„ŸåŸºèª¿ï¼š${mood}${selectedMoods.length > 1 ? 'ï¼ˆæ··åˆæƒ…ç·’ï¼‰' : ''}
ä¸»è¦æ¨‚å™¨ï¼š${instruments}
èªè¨€ï¼š${language}
æ¼”å”±è²éŸ³ï¼š${voice}
æ­Œæ›²é•·åº¦ï¼š${duration}
${requirements ? `ç‰¹æ®Šéœ€æ±‚ï¼š${requirements}` : ''}

è«‹å‹™å¿…éµå®ˆä»¥ä¸‹æ ¼å¼è¦æ±‚ï¼ˆé€™æ˜¯ Suno AI çš„æ¨™æº–æ ¼å¼ï¼‰ï¼š
1. ä½¿ç”¨æ–¹æ‹¬è™Ÿæ¨™è¨»æ®µè½ï¼š[Intro]ã€[Verse 1]ã€[Chorus]ã€[Verse 2]ã€[Bridge]ã€[Outro] ç­‰
2. ${structureGuide}
3. æ¯å€‹æ®µè½ä¹‹é–“ç©ºä¸€è¡Œ
4. Chorusï¼ˆå‰¯æ­Œï¼‰æ ¹æ“šæ­Œæ›²é•·åº¦é‡è¤‡ 2-3 æ¬¡
5. æ¯è¡Œæ­Œè©ä¸è¦å¤ªé•·ï¼ˆé©åˆæ¼”å”±ï¼‰
6. æŠ¼éŸ»è‡ªç„¶ï¼Œæœ‰ç¯€å¥æ„Ÿ
7. å¦‚æœæ˜¯æ··åˆèªè¨€ï¼Œè¦è‡ªç„¶èåˆï¼Œä¸è¦ç”Ÿç¡¬
8. å¦‚æœæ˜¯ç”·å¥³å°å”±ï¼Œè«‹ç”¨ [Male] å’Œ [Female] æ¨™è¨»ä¸åŒè²éƒ¨

${selectedGenres.length > 1 ? `ç‰¹åˆ¥æ³¨æ„ï¼šé€™æ˜¯æ··æ­é¢¨æ ¼ï¼ˆ${genre}ï¼‰ï¼Œè«‹èåˆé€™äº›é¢¨æ ¼çš„ç‰¹è‰²ï¼Œå‰µé€ ç¨ç‰¹çš„éŸ³æ¨‚æ„Ÿè¦ºã€‚` : ''}

${selectedMoods.length > 1 ? `ç‰¹åˆ¥æ³¨æ„ï¼šé€™æ˜¯æ··åˆæƒ…ç·’ï¼ˆ${mood}ï¼‰ï¼Œæ­Œè©è¦èƒ½å±•ç¾é€™äº›æƒ…æ„Ÿçš„è½‰æ›æˆ–ä¸¦å­˜ã€‚` : ''}

${instruments !== 'ä¸æŒ‡å®š' ? `ç‰¹åˆ¥æ³¨æ„ï¼šä¸»è¦æ¨‚å™¨åŒ…å«${instruments}ï¼Œæ­Œè©çš„ç¯€å¥å’Œæ°›åœè¦èƒ½é…åˆé€™äº›æ¨‚å™¨çš„ç‰¹è‰²ã€‚` : ''}

${language === 'æ—¥æ–‡' || language === 'æ—¥è‹±æ··åˆ' ? 'ç‰¹åˆ¥æ³¨æ„ï¼šæ—¥æ–‡æ­Œè©è«‹ä½¿ç”¨å¹³å‡åã€ç‰‡å‡åå’Œæ¼¢å­—çš„è‡ªç„¶çµ„åˆï¼Œç¬¦åˆæ—¥èªæ­Œè©çš„æ›¸å¯«ç¿’æ…£ã€‚' : ''}

${voice === 'ç”·å¥³å°å”±' ? 'ç‰¹åˆ¥æ³¨æ„ï¼šè«‹æ˜ç¢ºæ¨™è¨»å“ªäº›æ®µè½æ˜¯ç”·è²æ¼”å”± [Male]ï¼Œå“ªäº›æ˜¯å¥³è²æ¼”å”± [Female]ï¼Œå“ªäº›æ˜¯åˆå”± [Chorus - Both]ã€‚' : ''}

${count > 1 ? `æ³¨æ„ï¼šé€™æ˜¯ç¬¬ ${i + 1} é¦–æ­Œè©ï¼Œè«‹æä¾›èˆ‡ä¹‹å‰ä¸åŒçš„å‰µæ„è§’åº¦å’Œæ­Œè©å…§å®¹ï¼Œä½†ä¿æŒä¸»é¡Œä¸€è‡´ã€‚` : ''}

è«‹ç›´æ¥è¼¸å‡ºæ­Œè©å…§å®¹ï¼Œä¸éœ€è¦é¡å¤–èªªæ˜ã€‚`;

                    const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }],
                            generationConfig: {
                                temperature: 0.9,
                                topK: 40,
                                topP: 0.95,
                                maxOutputTokens: 2048,
                            }
                        })
                    });

                    if (!response.ok) {
                        if (response.status === 400) {
                            throw new Error('API é‡‘é‘°ç„¡æ•ˆï¼Œè«‹é‡æ–°è¨­å®šï¼');
                        }
                        throw new Error('API è«‹æ±‚å¤±æ•—');
                    }

                    const data = await response.json();
                    const lyrics = data.candidates[0].content.parts[0].text;
                    
                    if (count > 1) {
                        allLyrics.push(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ æ­Œè©ç‰ˆæœ¬ ${i + 1}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

${lyrics}`);
                    } else {
                        allLyrics.push(lyrics);
                    }

                    if (count > 1) {
                        loading.querySelector('p').textContent = `AI æ­£åœ¨å‰µä½œç¬¬ ${i + 1}/${count} é¦–æ­Œè©...`;
                    }
                }

                // ç”Ÿæˆé¢¨æ ¼æç¤ºè©
                const selectedGenres = getSelectedValues('genre');
                const selectedMoods = getSelectedValues('mood');
                const selectedInstruments = getSelectedValues('instruments');
                
                const stylePrompt = await generateStylePrompt(
                    theme,
                    selectedGenres,
                    selectedMoods,
                    selectedInstruments,
                    language,
                    voice,
                    duration,
                    requirements
                );

                // é¡¯ç¤ºçµæœ
                document.getElementById('lyricsOutput').textContent = allLyrics.join('\n\n\n');
                
                // é¡¯ç¤ºé¢¨æ ¼æç¤ºè©
                if (stylePrompt) {
                    document.getElementById('stylePromptOutput').textContent = stylePrompt;
                    document.getElementById('stylePromptSection').style.display = 'block';
                } else {
                    document.getElementById('stylePromptSection').style.display = 'none';
                }
                
                resultSection.classList.add('show');
                saveFormState();

            } catch (error) {
                console.error('éŒ¯èª¤:', error);
                alert('ç”Ÿæˆå¤±æ•—ï¼š' + error.message);
                
                if (error.message.includes('API é‡‘é‘°')) {
                    openApiModal();
                }
            } finally {
                generateBtn.disabled = false;
                loading.classList.remove('show');
                loading.querySelector('p').textContent = 'AI æ­£åœ¨ç‚ºä½ å‰µä½œæ­Œè©...';
            }
        }

        function copyLyrics() {
            const lyrics = document.getElementById('lyricsOutput').textContent;
            navigator.clipboard.writeText(lyrics).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'âœ… å·²è¤‡è£½ï¼';
                btn.style.background = '#2ecc71';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#4CAF50';
                }, 2000);
            }).catch(err => {
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½');
            });
        }

        function openSuno() {
            window.open('https://suno.com/', '_blank');
        }

        // åŒ¯å‡ºæ­Œè©å’Œè¨­å®š
        function exportLyrics() {
            const exportData = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                settings: {
                    theme: document.getElementById('theme').value,
                    genre: getSelectedValues('genre'),
                    mood: getSelectedValues('mood'),
                    instruments: getSelectedValues('instruments'),
                    language: document.getElementById('language').value,
                    voice: document.getElementById('voice').value,
                    duration: document.getElementById('duration').value,
                    count: document.getElementById('count').value,
                    requirements: document.getElementById('requirements').value
                },
                lyrics: document.getElementById('lyricsOutput').textContent
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            
            const theme = exportData.settings.theme || 'æœªå‘½å';
            const date = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            link.download = `æ­Œè©_${theme}_${date}.json`;
            
            link.click();
            URL.revokeObjectURL(url);

            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'âœ… å·²åŒ¯å‡ºï¼';
            btn.style.background = '#4caf50';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = '';
            }, 2000);
        }

        // åŒ¯å…¥æ­Œè©å’Œè¨­å®š
        function importLyrics(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importData = JSON.parse(e.target.result);
                    
                    if (!importData.settings || !importData.lyrics) {
                        throw new Error('æª”æ¡ˆæ ¼å¼ä¸æ­£ç¢º');
                    }

                    const settings = importData.settings;
                    document.getElementById('theme').value = settings.theme || '';
                    
                    // æ¸…é™¤ä¸¦æ¢å¾©é¢¨æ ¼
                    clearAll('genre');
                    if (Array.isArray(settings.genre)) {
                        settings.genre.forEach(value => {
                            const checkbox = document.getElementById(`g_${value}`);
                            if (checkbox) checkbox.checked = true;
                        });
                        updateMultiSelect('genre');
                    }
                    
                    // æ¸…é™¤ä¸¦æ¢å¾©æƒ…æ„Ÿ
                    clearAll('mood');
                    if (Array.isArray(settings.mood)) {
                        settings.mood.forEach(value => {
                            const checkbox = document.getElementById(`m_${value}`);
                            if (checkbox) checkbox.checked = true;
                        });
                        updateMultiSelect('mood');
                    }
                    
                    // æ¸…é™¤ä¸¦æ¢å¾©æ¨‚å™¨
                    clearAll('instruments');
                    if (Array.isArray(settings.instruments)) {
                        settings.instruments.forEach(value => {
                            const checkbox = document.getElementById(`i_${value}`);
                            if (checkbox) checkbox.checked = true;
                        });
                        updateMultiSelect('instruments');
                    }
                    
                    document.getElementById('language').value = settings.language || 'ä¸­æ–‡';
                    document.getElementById('voice').value = settings.voice || 'ç”·è²';
                    document.getElementById('duration').value = settings.duration || 'æ¨™æº– (3-3.5åˆ†é˜)';
                    document.getElementById('count').value = settings.count || '1';
                    document.getElementById('requirements').value = settings.requirements || '';

                    document.getElementById('lyricsOutput').textContent = importData.lyrics;
                    document.getElementById('resultSection').classList.add('show');

                    saveFormState();

                    alert('âœ… åŒ¯å…¥æˆåŠŸï¼');
                } catch (error) {
                    alert('âŒ åŒ¯å…¥å¤±æ•—ï¼š' + error.message);
                }
            };
            reader.readAsText(file);
            
            event.target.value = '';
        }

        // Enter éµå¿«é€Ÿç”Ÿæˆ
        document.getElementById('theme').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                generateLyrics();
            }
        });

        // API æ¨¡æ…‹è¦–çª—çš„ Enter éµæ”¯æ´
        document.getElementById('apiKeyInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                saveApiKey();
            }
        });
    </script>
</body>
</html>
